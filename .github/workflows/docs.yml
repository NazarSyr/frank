name: Docs

# Run this workflow every time a new commit pushed to your repository
on: push

jobs:
  test:
    name: Build and deploy docs
    runs-on: ubuntu-20.04

    steps:
      # Checks out a copy of your repository on the ubuntu-latest machine
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.7
      - name: Display Python version
        run: python -c "import sys; print(sys.version)"
      - name: Install docs dependencies
        run: |
          sudo apt-get install pandoc
          pip install setuptools --upgrade
          pip install .[test,docs-build]
      - name: Install and build docs
        run: |
          pip install .
          cd docs
          make html
      - name: Run unit tests
        run: |
          mkdir -p test-reports
          py.test --junitxml=test-reports/junit.xml frank/tests.py
      - name: Coverage
        run: |
          coverage run --source=frank -m pytest frank/tests.py
          coverage report
          mkdir -p docs/_build/html/coverage
          coverage html -d docs/_build/html/coverage
          coverage-badge -f -o docs/_build/html/coverage/badge.svg